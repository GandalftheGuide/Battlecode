package ProtoPlayer;

import java.util.ArrayList;

import battlecode.common.*;

public class Archon{
	public static RobotController rc = RobotPlayer.rc;
	public static ArrayList<RobotInfo> closeNeut = new ArrayList<RobotInfo>();
	public static ArrayList<RobotInfo> farNeut = new ArrayList<RobotInfo>();
	public static boolean neutInProx = true;
	public static boolean id;

	public static void setRun() throws GameActionException{

		
		if (rc.getRoundNum() == 0) {
			if (rc.getType() == RobotType.ARCHON) {
				rc.broadcastMessageSignal(73646, 0, 5000);

				Signal[] received = rc.emptySignalQueue();
				int numArchons = 0;
				for (Signal s : received) {
					if (s.getMessage() != null && s.getMessage()[0] == 73646) {
						numArchons++;
					}
				}
				if (numArchons == 0) {
					id = true;
				}else{id = false;} 
			}
		}
	
		
		else{
			if(id == true){
				shouldRun();
				Utility.sendingInstructions();
				Direction randD = Utility.randomDirection();
				if(rc.isCoreReady()&& rc.canBuild(randD, RobotType.SOLDIER))
					rc.build(Utility.isClear(randD), RobotType.SOLDIER);
			}
			else if(id == false){
				MapLocation archon = Utility.followingInstructions();
				Direction randomD = Utility.randomDirection();
				
				shouldRun();
				
				if(neutInProx){
					activeNeut();
				}

				if(rc.getRoundNum()< 45 && rc.getLocation().distanceSquaredTo(archon) > 8 && rc.isCoreReady()){
					Utility.advance(rc.getLocation().directionTo(archon), 1);
				}
				else if(rc.isCoreReady() && rc.canBuild(randomD, RobotType.SOLDIER)){
					rc.build(Utility.isClear(randomD), RobotType.SOLDIER);
				}
			}
		}
	}

	public static void shouldRun() throws GameActionException{
		RobotInfo [] enemies = rc.senseHostileRobots(rc.getLocation(), 24);
		RobotInfo [] enemiesFar = rc.senseHostileRobots(rc.getLocation(), 50);

		
		if(enemies.length > 4 && rc.isCoreReady()){
			Utility.advance((rc.getLocation().directionTo(enemies[0].location)).opposite(), 1);
		}
		else if(enemiesFar.length > 6 && rc.isCoreReady()){
			Utility.advance((rc.getLocation().directionTo(enemiesFar[0].location)).opposite(), 1);
		}
	}

	public static void activeNeut() throws GameActionException{

		RobotInfo[] neutR = rc.senseNearbyRobots(25, Team.NEUTRAL);

		for(int i = 0; i<neutR.length; i++){
			if(rc.getLocation().distanceSquaredTo(neutR[i].location) < 3){
				closeNeut.add(neutR[i]);
			}
			if(rc.getLocation().distanceSquaredTo(neutR[i].location) >= 3){
				farNeut.add(neutR[i]);
			}
		}
		if((farNeut.isEmpty() && closeNeut.isEmpty()) || rc.getRoundNum() > 9){
			neutInProx = false;
		}

		if(closeNeut.size()>0){
			for(int i = 0; i<closeNeut.size(); i++){
				if(rc.isCoreReady()){
					rc.activate(closeNeut.remove(0).location);
				}
			}
		}else if(farNeut.size()>0){
			for(int i = 0; i<farNeut.size(); i++){
				if(rc.isCoreReady()){
					Utility.advance(rc.getLocation().directionTo(farNeut.get(i).location),1);
				}
			}
		}
	}

}

